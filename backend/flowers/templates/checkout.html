{% extends 'base.html' %}
{% block title %}Պատվեր - Ծաղիկ{% endblock %}

{% block content %}
<div class="min-h-screen py-12">
    <div class="container mx-auto px-4 md:px-8">
        <div class="mb-8 animate-fade-in">
            <h1 class="text-4xl md:text-5xl font-serif font-bold mb-2">
                Պատվեր
            </h1>
            <p class="text-muted-foreground">
                Լրացրեք ձեր տվյալները և ավարտեք գնումը
            </p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Order Form -->
            <div class="lg:col-span-2 animate-fade-in">
                <form method="POST" action="{% url 'checkout' %}{% if is_buy_now %}?buy_now={{ cart_items.0.id }}&quantity={{ cart_items.0.quantity }}{% endif %}" class="space-y-8">
                    {% csrf_token %}
                    
                    <!-- Customer Information -->
                    <div class="bg-white rounded-2xl p-6 border border-border/50 shadow-sm">
                        <h2 class="font-serif text-2xl font-bold mb-6">
                            Անձնական տվյալներ
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label for="fullName" class="block text-sm font-medium mb-2">Անուն Ազգանուն *</label>
                                <input type="text" id="fullName" name="fullName" required class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="Անուն Ազգանուն" data-testid="checkout-full-name">
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-medium mb-2">Հեռախոս *</label>
                                <input type="tel" id="phone" name="phone" required class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="+374 XX XXXXXX" data-testid="checkout-phone">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium mb-2">Էլ. փոստ (ոչ պարտադիր)</label>
                                <input type="email" id="email" name="email" class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="email@example.com" data-testid="checkout-email">
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Information -->
                    <div class="bg-white rounded-2xl p-6 border border-border/50 shadow-sm">
                        <h2 class="font-serif text-2xl font-bold mb-6">
                            Առաքման տվյալներ
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label for="city" class="block text-sm font-medium mb-2">Քաղաք *</label>
                                <input type="text" id="city" name="city" required class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="Երևան" data-testid="checkout-city">
                            </div>
                            <div>
                                <label for="address" class="block text-sm font-medium mb-2">Հասցե *</label>
                                <textarea id="address" name="address" required rows="3" class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="Փողոց, տուն, բնակարան" data-testid="checkout-address"></textarea>
                            </div>
                            <div>
                                <label for="bacik_erktox" class="block text-sm font-medium mb-2">Բացիկի տեքստ (ոչ պարտադիր)</label>
                                <textarea id="bacik_erktox" name="bacik_erktox" rows="3" class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="Ձեր հաղորդագրությունը բացիկի վրա" data-testid="checkout-card-text"></textarea>
                            </div>
                            <div>
                                <label for="notes" class="block text-sm font-medium mb-2">Լրացուցիչ նշումներ (ոչ պարտադիր)</label>
                                <textarea id="notes" name="notes" rows="2" class="w-full px-4 py-3 rounded-lg border border-border focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="Որևէ հատուկ ցանկություն" data-testid="checkout-notes"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="bg-white rounded-2xl p-6 border border-border/50 shadow-sm">
                        <h2 class="font-serif text-2xl font-bold mb-6">
                            Վճարման եղանակ
                        </h2>
                        <div class="space-y-3">
                            <label class="flex items-center gap-3 p-4 rounded-lg border border-border hover:bg-muted cursor-pointer transition-all">
                                <input type="radio" name="paymentMethod" value="cash" checked class="w-5 h-5 text-primary" data-testid="payment-cash">
                                <div class="flex-1">
                                    <div class="font-semibold">Կանխիկ առաքման ժամանակ</div>
                                    <div class="text-sm text-muted-foreground">Վճարեք կուրիերին առաքման ժամանակ</div>
                                </div>
                            </label>
                            <label class="flex items-center gap-3 p-4 rounded-lg border border-border hover:bg-muted cursor-pointer transition-all">
                                <input type="radio" name="paymentMethod" value="card" class="w-5 h-5 text-primary" data-testid="payment-card">
                                <div class="flex-1">
                                    <div class="font-semibold">Քարտով առաքման ժամանակ</div>
                                    <div class="text-sm text-muted-foreground">Վճարեք քարտով կուրիերի մոտ</div>
                                </div>
                            </label>
                            <label class="flex items-center gap-3 p-4 rounded-lg border border-border hover:bg-muted cursor-pointer transition-all">
                                <input type="radio" name="paymentMethod" value="online" class="w-5 h-5 text-primary" data-testid="payment-online">
                                <div class="flex-1">
                                    <div class="font-semibold">Առցանց վճարում</div>
                                    <div class="text-sm text-muted-foreground">Վճարեք հիմա քարտով (Stripe)</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-primary text-primary-foreground hover:bg-primary/90 rounded-full px-8 py-4 font-medium transition-all shadow-lg hover:shadow-primary/20 text-lg" data-testid="place-order-button">
                        Ավարտել պատվերը
                    </button>
                </form>
            </div>

            <!-- Order Summary -->
            <div class="lg:col-span-1 animate-fade-in">
                <div class="bg-white rounded-2xl p-6 border border-border/50 shadow-sm sticky top-24">
                    <h2 class="font-serif text-2xl font-bold mb-6">
                        Պատվերի ամփոփում
                    </h2>

                    <div class="space-y-4 mb-6" data-testid="checkout-summary">
                        {% for item in cart_items %}
                        <div class="flex gap-4">
                            <img src="{{ item.image }}" alt="{{ item.name }}" class="w-16 h-16 rounded-lg object-cover">
                            <div class="flex-1">
                                <h3 class="font-semibold text-sm">{{ item.name }}</h3>
                                <p class="text-xs text-muted-foreground">{{ item.quantity }} հատ × {{ item.price|floatformat:0 }} ֏</p>
                                <p class="text-sm font-semibold text-primary">
                                    {% if item.sale_price %}
                                    {{ item.sale_subtotal|floatformat:0 }} ֏
                                    {% else %}
                                    {{ item.subtotal|floatformat:0 }} ֏
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="border-t border-border pt-4 space-y-3">
                        <div class="flex justify-between text-lg">
                            <span class="text-muted-foreground">Ենթագումար</span>
                            <span class="font-semibold">{{ cart_total|floatformat:0 }} ֏</span>
                        </div>
                        <div class="flex justify-between text-lg">
                            <span class="text-muted-foreground">Առաքում</span>
                            <span class="font-semibold text-green-600">Անվճար</span>
                        </div>
                        <div class="border-t border-border pt-3">
                            <div class="flex justify-between text-2xl font-bold">
                                <span>Ընդամենը</span>
                                <span class="text-primary" data-testid="checkout-total">
                                    {{ cart_total|floatformat:0 }} ֏
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-accent/10 rounded-lg">
                        <div class="flex gap-3">
                            <svg class="w-5 h-5 text-accent-foreground flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-sm text-accent-foreground">
                                Ձեր պատվերը կավարտվի 1-3 աշխատանքային օրվա ընթացքում
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}